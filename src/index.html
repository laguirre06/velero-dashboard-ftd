<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="300">
    <title>Velero Backup Dashboard - FTD</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { background: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .header h1 { color: #667eea; margin-bottom: 10px; }
        .header p { color: #666; margin-bottom: 15px; }
        .last-update { font-size: 12px; color: #999; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center; }
        .stat-number { font-size: 42px; font-weight: bold; color: #667eea; margin-bottom: 5px; }
        .stat-label { color: #666; font-size: 13px; }
        .env-section { background: white; padding: 30px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .env-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid; }
        .env-dev { border-color: #107c10; }
        .env-hom { border-color: #ff8c00; }
        .env-prod { border-color: #d83b01; }
        .env-title { font-size: 22px; font-weight: bold; }
        .chart-container { position: relative; height: 250px; margin: 20px 0; }
        .backup-list { max-height: 350px; overflow-y: auto; }
        .backup-item { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #667eea; }
        .backup-name { font-weight: bold; color: #333; margin-bottom: 5px; font-size: 14px; }
        .backup-meta { font-size: 11px; color: #666; line-height: 1.4; }
        .status-badge { display: inline-block; padding: 3px 10px; border-radius: 10px; font-size: 10px; font-weight: bold; margin-left: 5px; }
        .status-completed { background: #d4edda; color: #155724; }
        .status-failed { background: #f8d7da; color: #721c24; }
        .status-progress { background: #fff3cd; color: #856404; }
        .loading { text-align: center; padding: 40px; color: #666; }
        .error { color: #d83b01; background: #ffe6e6; padding: 15px; border-radius: 8px; margin: 10px 0; font-size: 13px; }
        @media (max-width: 768px) { .stats-grid { grid-template-columns: 1fr; } .env-header { flex-direction: column; align-items: flex-start; gap: 10px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Velero Backup Dashboard - FTD</h1>
            <p>Monitoramento visual dos backups DEV/HOM/PROD</p>
            <div class="last-update" id="lastUpdate">Carregando...</div>
        </div>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-number" id="totalBackups">-</div><div class="stat-label">Total Backups (7 dias)</div></div>
            <div class="stat-card"><div class="stat-number" id="successRate">-</div><div class="stat-label">Taxa de Sucesso</div></div>
            <div class="stat-card"><div class="stat-number" id="totalStorage">-</div><div class="stat-label">Storage Usado</div></div>
            <div class="stat-card"><div class="stat-number" id="activeEnvs">-</div><div class="stat-label">Ambientes</div></div>
        </div>
        <div id="environments"><div class="loading">Carregando dados...</div></div>
    </div>
    <script>
        const DATA_URL = 'data/data.json';
        const environments = ['DEV', 'HOM', 'PROD'];
        let charts = {};
        async function loadData() {
            try {
                const response = await fetch(DATA_URL + '?t=' + Date.now());
                const data = await response.json();
                renderDashboard(data);
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                document.getElementById('environments').innerHTML = '<div class="error">Erro ao carregar dados. Atualize a pagina.</div>';
            }
        }
        function renderDashboard(data) {
            const container = document.getElementById('environments');
            container.innerHTML = '';
            let totalBackups = 0, totalSuccess = 0, totalFailed = 0, totalStorage = 0, activeEnvs = 0;
            environments.forEach(env => {
                const envData = data[env] || { backups: [], storage_gb: 0 };
                const backupStats = envData.backups.reduce((acc, b) => { acc.total++; if (b.status === 'Completed') acc.completed++; if (b.status === 'Failed') acc.failed++; return acc; }, { total: 0, completed: 0, failed: 0 });
                totalBackups += backupStats.total; totalSuccess += backupStats.completed; totalFailed += backupStats.failed; totalStorage += envData.storage_gb || 0; if (backupStats.total > 0) activeEnvs++;
                const envDiv = document.createElement('div');
                envDiv.className = 'env-section env-' + env.toLowerCase();
                envDiv.innerHTML = '<div class="env-header env-' + env.toLowerCase() + '"><div class="env-title">' + env + '</div><div style="font-size:13px;color:#666">Storage: <strong>' + (envData.storage_gb||0).toFixed(1) + ' GB</strong> | Backups: <strong>' + backupStats.total + '</strong></div></div><div style="display:grid;grid-template-columns:1fr 1.5fr;gap:20px;align-items:start"><div class="chart-container"><canvas id="chart-' + env + '"></canvas></div><div class="backup-list">' + (envData.backups.length>0?envData.backups.map(b=>'<div class="backup-item"><div class="backup-name">'+b.name+'</div><div class="backup-meta">'+new Date(b.created).toLocaleString('pt-BR')+'<br>'+(b.namespaces?.join(', ')||'Todos') +'<br>Status: <span class="status-badge status-'+b.status.toLowerCase()+'>'+b.status+'</span></div></div>').join(''):'<div style="color:#999;font-size:13px;padding:20px">Nenhum backup nos ultimos 7 dias</div>') + '</div></div>';
                container.appendChild(envDiv);
                createChart(env, backupStats);
            });
            document.getElementById('totalBackups').textContent = totalBackups;
            document.getElementById('successRate').textContent = totalBackups>0?((totalSuccess/totalBackups)*100).toFixed(0)+'%':'0%';
            document.getElementById('totalStorage').textContent = totalStorage.toFixed(1) + ' GB';
            document.getElementById('activeEnvs').textContent = activeEnvs;
            document.getElementById('lastUpdate').textContent = 'Ultima atualizacao: ' + new Date(data.timestamp).toLocaleString('pt-BR');
        }
        function createChart(env, stats) {
            const ctx = document.getElementById('chart-' + env); if (!ctx) return; if (charts[env]) charts[env].destroy();
            const inProgress = Math.max(0, stats.total - stats.completed - stats.failed);
            charts[env] = new Chart(ctx, { type: 'doughnut', data: { labels: ['Sucesso','Falhas','Em Progresso'], datasets: [{ data: [stats.completed, stats.failed, inProgress], backgroundColor: ['#107c10','#d83b01','#ff8c00'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { position: 'bottom', labels: { font: { size: 10 } } } } });
        }
        window.onload = loadData;
    </script>
</body>
</html>